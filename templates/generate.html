<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Key | Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .form-container {
            max-width: 600px;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">Admin Panel</div>
                <button class="sidebar-close" onclick="toggleSidebar()" aria-label="Close Sidebar" title="Close Sidebar">âœ•</button>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/dashboard" class="nav-link">
                        <span>ðŸ“Š</span> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/generate" class="nav-link active">
                        <span>ðŸ”‘</span> Generate Key
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/keys" class="nav-link">
                        <span>ðŸ“‹</span> All Keys
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/stats" class="nav-link">
                        <span>ðŸ“ˆ</span> Statistics
                    </a>
                </li>
            </ul>
            <div style="margin-top: auto;">
                <a href="/logout" class="nav-link">
                    <span>ðŸšª</span> Logout
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Toggle Menu" title="Toggle Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="page-title">
                    <h2>Generate Key</h2>
                    <p>Create new access keys</p>
                </div>
                <div class="actions">
                    <button class="btn btn-icon" onclick="toggleTheme()" title="Toggle Theme">
                        <span id="themeIcon">ðŸŒ™</span>
                    </button>
                </div>
            </header>

            <div class="form-container">
                <div class="stat-card">
                    <form id="keyForm" method="POST">
                        <div style="margin-bottom: 1.5rem;">
                            <label for="duration" class="stat-label"
                                style="display: block; margin-bottom: 0.5rem;">Duration (Days)</label>
                            <select id="duration" name="duration" class="search-input" style="width: 100%;">
                                <option value="7">7 Days</option>
                                <option value="30" selected>30 Days</option>
                                <option value="90">90 Days</option>
                                <option value="365">365 Days</option>
                            </select>
                        </div>

                        <div class="actions" style="justify-content: center;">
                            <button type="submit" class="btn btn-primary">Generate Key</button>
                        </div>
                    </form>
                </div>

                {% if message %}
                <div class="stat-card" id="generatedKey" style="margin-top: 1.5rem; border-color: var(--success);">
                    <div class="stat-trend" style="font-size: 1rem; margin-bottom: 0.5rem; color: var(--success);">
                        {{ message }}
                    </div>
                    {% if last_key %}
                    <div style="margin-top: 1rem;">
                        <div class="stat-label">New Key</div>
                        <div
                            style="display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap;">
                            <div class="stat-value"
                                style="font-size: 1.25rem; font-family: monospace; word-break: break-all; flex: 1;"
                                id="keyValue">{{ last_key.key }}</div>
                            <button class="btn btn-secondary" onclick="copyKey()" type="button" title="Copy Key">
                                <span id="copyIcon">ðŸ“‹</span> Copy
                            </button>
                        </div>
                        <div class="stat-label" style="margin-top: 0.5rem;">Expires in {{ last_key.duration }} days
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </main>
    </div>

    <script>
        // Theme Management
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.getElementById('themeIcon').textContent = newTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
        }

        // Load saved theme
        (function () {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
        })();

        // Sidebar Toggle
        function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('collapsed');
                if (window.innerWidth > 768) {
                localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
            }
        }

        // Load sidebar state
        (function () {
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (isCollapsed) {
                document.getElementById('sidebar').classList.add('collapsed');
            }
            // Auto-close sidebar on mobile when any nav link is clicked
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.add('collapsed');
                    }
                });
            });
        })();

        // Copy Key Function
        function copyKey() {
            const keyValue = document.getElementById('keyValue').textContent;
            navigator.clipboard.writeText(keyValue).then(() => {
                const copyIcon = document.getElementById('copyIcon');
                const btn = copyIcon.parentElement;
                copyIcon.textContent = 'âœ“';
                btn.style.background = 'linear-gradient(135deg, var(--success), #059669)';
                btn.style.color = 'white';
                setTimeout(() => {
                    copyIcon.textContent = 'ðŸ“‹';
                    btn.style.background = '';
                    btn.style.color = '';
                }, 2000);
            }).catch(err => {
                alert('Failed to copy key');
            });
        }
    </script>
</body>

</html>